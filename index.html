<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informed Consent</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>


    <section class="hero has-background-warning	">
        <button class="button is-primary" id="langtrigger" data-eng="true"> Malayalam Version</button>

        <div class="hero-body has-text-centered">
            <p class="title">
                Covidiots Covid 19 Facts Kerala
            </p>
            <p class="subtitle">
                Short bullet points to explain the scam going on to coersive people
            </p>

        </div>
    </section>


    <section class="section has-background-grey">
        <ul class="ul">

            <div class="columns">
                <div class="column  ul-container"></div>
            </div>

        </ul>
    </section>


    <script>
        // fetch('https://raw.githubusercontent.com/AmarjithTK/storage__bin/master/coaid.json').then(data => data.json()).
        // then(json => updateData(json))


        const malurl = 'https://raw.githubusercontent.com/AmarjithTK/storage__bin/master/cdn/malcoaid.json'
        const engurl = 'https://raw.githubusercontent.com/AmarjithTK/storage__bin/master/cdn/engcoaid.json'


        const langtrigger = document.getElementById('langtrigger')
        const title = document.querySelector('.title')
        const subtitle = document.querySelector('.subtitle')
        const ulcontainer = document.querySelector('.ul-container')




        const fetchdata = async (url) => {
            try {
                console.log(url);
                const data = await fetch(url)
                const jsondata = await data.json()
                console.log(jsondata);
                updatebody(jsondata)
            } catch (error) {
                console.log(error);
                // location.reload()
            }
        }


        const updatebody = (data) => {

            const dbuttontext = data['buttonText']
            const dtitle = data['title']
            const dsubtitle = data['subtitle']
            const dbullet = data['bulletpoints']


            langtrigger.innerHTML = dbuttontext
            title.innerHTML = dtitle
            subtitle.innerHTML = dsubtitle


            dbullet.forEach(element => {

                try {
                    if (element["sources"].length > 0) {

                        template = `<div class="box mb-2 has-text-centered">${element['text']}  `

                        element["sources"].forEach(elem => {
                            template += `<a href="${elem}">Ref</a>,`
                        })
                        template += '</div>'

                        ulcontainer.innerHTML += template

                    }
                } catch (error) {
                    ulcontainer.innerHTML += ` <div class="box mb-2 has-text-centered">${element}</div>`

                }


            });
            langtrigger.classList.remove('is-loading') // remove the loading once fetch finished

        }

        const triggerHandler = (e) => {
            console.log('here i am');
            langtrigger.classList.add('is-loading')

            // e.preventDefault()
            if (langtrigger.getAttribute('data-eng') == 'true') {
                langtrigger.classList.add('is-link')
                fetchdata(malurl)
                langtrigger.setAttribute('data-eng', 'false')
            } else if (langtrigger.getAttribute('data-eng') == 'false') {
                langtrigger.classList.remove('is-link')
                fetchdata(engurl)
                langtrigger.setAttribute('data-eng', 'true')
            }


        }


        fetchdata(engurl) // starting in english


        langtrigger.addEventListener('click', triggerHandler)
        //   const ul = document.querySelector('.ul');
    </script>
</body>

</html>